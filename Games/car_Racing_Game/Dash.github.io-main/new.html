<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Dash</title>
    <link rel="icon" href="icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Press+Start+2P"/>

    <style>
        body {
            background: #222;
            font-family: "Press Start 2P", monospace;
            font-smooth: never;
            height: 98vh;
        }

        /* UI */
        .topUI {
            position: absolute;
            z-index: 1000; /* need this cause clip-path changes stack context */
            transform: translate(-50%, 25px);
            text-shadow: -2px 0 black, 0 2px black, 2px 0 black, 0 -2px black;
            letter-spacing: 2px;
            color: #fff;
            font-size: 17px;
        }

        .topUI::before {
            display: inline-block;
            height: 17px;
            padding: 1px 2px;
            line-height: 19px;
            font-size: 17px;
            background: #fff;
            text-shadow: none;
            font-weight: 900;
            letter-spacing: 0;
            border-radius: 6px;
            margin-right: 30px;
            border: 2px solid #7dd8c9;
        }

        #time {
            left: 13%;
            color: #f4f430;
        }

        #time::before {
            content: "TIME";
            color: #f57214;
        }

        #score {
            left: 45%;
        }

        #score::before {
            content: "SCORE";
            color: #a61a9d;
        }

        #lap {
            left: 88%;
            width: 45%;
        }

        #lap::before {
            content: "LAP";
            color: #0082df;
        }

        #tacho {
            position: absolute;
            text-align: right;
            width: 23%;
            bottom: 5%;
            z-index: 2000;
            color: #e62e13;
            text-shadow: -2px 0 black, 0 2px black, 2px 0 black, 0 -2px black;
            letter-spacing: 2px;
            font-size: 23px;
        }

        #tacho::after {
            content: "km/h";
            color: #fab453;
            font-size: 18px;
            margin-left: 5px;
        }

        /*
        road
        */
        #game {
            position: relative;
            margin: 0 auto;
            overflow: hidden;
            background: #222;
            user-select: none;
            transition: opacity 10s;
        }

        #road {
            transition: opacity 2s;
            transition-timing-function: steps(8, end);
        }

        #road * {
            position: absolute;
            image-rendering: pixelated;
        }

        #hero {
            background-repeat: no-repeat;
            background-position: -110px 0;
            z-index: 2000;
            transform: scale(1.4);
        }

        #cloud {
            background-size: auto 100%;
            width: 100%;
            height: 57%;
        }

        /*
        home
        */
        #road {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        #home {
            position: absolute;
            color: #fff;
            width: 100%;
            height: 100%;

            z-index: 1000; /* need this cause clip-path changes stack context */
        }

        #highscore {
            position: absolute;
            width: 100%;
            height: 20%;
            bottom: 0;
            column-count: 3;
            column-fill: auto;
        }

        #highscore * {
            color: #9e95a8;
            margin: 0 0 6px 27px;
        }

        h1 {
            position: absolute;
            left: 50%;
            top: 25%;
            transform: translate(-50%, -50%);
            font-size: 5em;

            background: -webkit-linear-gradient(#25d8b1, #e2bbf0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            color: #d9bbf3;
            text-shadow: 0 0 black, 0 0 black;
            line-height: 1.5em;
            text-align: center;
        }

        #controls {
            position: absolute;
            right: 5%;
            bottom: 5%;
            font-size: 14px;
            color: #fff;
        }

        #controls span {
            display: block;
            margin-bottom: 5px;
        }

        #controls span span {
            display: inline-block;
            width: 20px;
            margin-right: 10px;
            text-align: center;
        }

        #controls span span:last-child {
            margin-right: 0;
        }
    </style>

    <script>
        const game = document.getElementById('game');
        const home = document.getElementById('home');
        const road = document.getElementById('road');
        const hero = document.getElementById('hero');
        const cloud = document.getElementById('cloud');
        const hud = document.getElementById('hud');
        const scoreUI = document.getElementById('score');
        const timeUI = document.getElementById('time');
        const lapUI = document.getElementById('lap');
        const tachoUI = document.getElementById('tacho');
        const textUI = document.getElementById('text');
        const highscoreUI = document.getElementById('highscore');

        const controls = {
            ArrowLeft: false,
            ArrowRight: false,
            KeyC: false,
            KeyM: false
        };

        let speed = 0;
        let maxSpeed = 200;
        let acc = 0.5;
        let roadY = 0;
        let heroX = 110;
        let heroY = 0;
        let roadPieceHeight = 128;
        let lap = 0;
        let score = 0;
        let playing = false;
        let muted = false;

        const startGame = () => {
            playing = true;
            home.style.opacity = 0;
            setTimeout(() => {
                game.style.opacity = 1;
                requestAnimationFrame(update);
            }, 2000);
        };

        const endGame = () => {
            playing = false;
            setTimeout(() => {
                road.style.opacity = 0;
                game.style.opacity = 0;
                home.style.opacity = 1;
                textUI.textContent = "Game Over!";
                updateHighscore();
            }, 2000);
        };

        const update = () => {
            if (playing) {
                updateRoad();
                updateHero();
                updateScore();
                updateSpeed();
                updateTacho();
                requestAnimationFrame(update);
            }
        };

        const updateRoad = () => {
            roadY -= speed;
            if (roadY < -roadPieceHeight) roadY += roadPieceHeight;
            road.style.top = roadY + 'px';
        };

        const updateHero = () => {
            if (controls.ArrowLeft && heroX > 5) heroX -= 8;
            if (controls.ArrowRight && heroX < 215) heroX += 8;
            hero.style.left = heroX + 'px';
        };

        const updateScore = () => {
            score += speed / 10;
            scoreUI.textContent = Math.floor(score);
        };

        const updateSpeed = () => {
            if (controls.ArrowUp && speed < maxSpeed) speed += acc;
            if (controls.ArrowDown && speed > 0) speed -= acc;
        };

        const updateTacho = () => {
            tachoUI.textContent = Math.floor(speed * 0.2);
        };

        const updateHighscore = () => {
            const storedHighscore = localStorage.getItem('highscore');
            const currentScore = Math.floor(score);
            if (!storedHighscore || currentScore > storedHighscore) {
                localStorage.setItem('highscore', currentScore);
                highscoreUI.innerHTML = '<div>HIGHSCORE</div><div>' + currentScore + '</div><div>' + getTime() + '</div>';
            } else {
                highscoreUI.innerHTML = '<div>HIGHSCORE</div><div>' + storedHighscore + '</div><div>' + getTime() + '</div>';
            }
        };

        const getTime = () => {
            const date = new Date(null);
            date.setSeconds(lap / 1000);
            return date.toISOString().substr(14, 5);
        };

        const keyDownHandler = (event) => {
            if (controls.hasOwnProperty(event.code)) {
                event.preventDefault();
                controls[event.code] = true;
                if (event.code === 'KeyC') startGame();
                if (event.code === 'KeyM') toggleMute();
            }
        };

        const keyUpHandler = (event) => {
            if (controls.hasOwnProperty(event.code)) {
                event.preventDefault();
                controls[event.code] = false;
            }
        };

        const toggleMute = () => {
            muted = !muted;
            if (muted) {
                muteAudio();
            } else {
                unmuteAudio();
            }
        };

        const muteAudio = () => {
            // Your audio mute logic here
        };

        const unmuteAudio = () => {
            // Your audio unmute logic here
        };

        document.addEventListener('keydown', keyDownHandler);
        document.addEventListener('keyup', keyUpHandler);

        textUI.textContent = "Press C to start!";
    </script>
</head>
<body translate="no">
<div id="game">
    <div id="road">
        <div id="cloud"></div>
        <div id="hero"></div>
    </div>

    <div id="hud">
        <span id="time" class="topUI">0</span>
        <span id="score" class="topUI">0</span>
        <span id="lap" class="topUI">0'00"000</span>
        <span id="tacho">0</span>
    </div>

    <div id="home">
        <h1>Dash</h1>
        <p id="text"></p>
        <div id="highscore"></div>
    </div>
</div>

<div id="controls">
    <span><span>S</span>Start Game</span>
    <span><span>M</span>mute</span>
    <span><span>&lt;</span><span>&gt;</span>move</span>
    <span><span>&lt;</span><span>&gt;</span>accelerate</span>
</div>

<script src="javascript/null.js"></script>
</body>
</html>
